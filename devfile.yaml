schemaVersion: 2.2.0
metadata:
  name: quarkus-prj
projects:
  - git:
      remotes:
        origin: https://github.com/pietroaragona/openshift-devspaces-quarkus-ibmz.git
    name: openshift-devspaces-quarkus-ibmz
  - git:
      remotes:
        origin: https://SIFEntrate1Collection@dev.azure.com/SIFEntrate1Collection/TP-ENT-SA-0007/_git/mono-repo
    name: monorepo
  - git:
      remotes:
        origin: https://SIFEntrate1Collection@dev.azure.com/SIFEntrate1Collection/TP-ENT-SA-0007/_git/nuovoaccertamento-manifest
    name: gitops
components:
  - attributes:
      controller.devfile.io/merge-contribution: true
    container:
      cpuLimit: 1500m
      cpuRequest: 400m
      endpoints:
        - exposure: none
          name: debug
          protocol: tcp
          targetPort: 5555
        - exposure: public
          name: app-be
          path: /openapi/ui
          protocol: http
          targetPort: 8080
      env:
        - name: CHE_DASHBOARD_URL
          value: https://devspaces.apps.zmvplab.cnt.sogei.it
        - name: CHE_PLUGIN_REGISTRY_URL
          value: https://devspaces.apps.zmvplab.cnt.sogei.it/plugin-registry/v3
        - name: CHE_PLUGIN_REGISTRY_INTERNAL_URL
          value: http://plugin-registry.openshift-devspaces.svc:8080/v3
        - name: CLUSTER_CONSOLE_URL
          value: https://console-openshift-console.apps.zmvplab.cnt.sogei.it
        - name: CLUSTER_CONSOLE_TITLE
          value: OpenShift console
        - name: OPENVSX_REGISTRY_URL
          value: https://open-vsx.org
      image: alm-repos.sogei.it/devfile/universal-developer-image:3.6_s390x_v1.0.0
      memoryLimit: 6G
      memoryRequest: 3G
      mountSources: true
      sourceMapping: /projects
      volumeMounts:
        - name: m2
          path: /home/user/.m2
    name: tools
  - name: m2
    volume:
      size: 2G
commands:
  - exec:
      commandLine: |
        # set java version
        #. /home/user/.sdkman/bin/sdkman-init.sh
        #JAVA_V=17.0.3-tem
        #sdk install java $JAVA_V
        #sdk default java $JAVA_V

        # configure settings.xml and .npmrc
        setup_configurations_files(){
          MVN_SETTINGS_REMOTE="https://alm-repos.sogei.it/repository/codeready-plugins/assets/settings-https-v3-with-proxy.xml"
          mkdir -p /home/user/.m2
          wget  -q --no-check-certificate $MVN_SETTINGS_REMOTE -O /home/user/.m2/settings.xml
          
          echo registry=https://alm-repos.sogei.it/repository/npm-group/ > /home/user/.npmrc
          echo cafile=/etc/pki/ca-trust/source/anchors/alm-repos.sogei.it-ca.crt >> /home/user/.npmrc
        }
        setup_configurations_files

        # configure git credential.helper
        git config --global credential.helper 'cache --timeout 36000'
      component: tools
      label: 0.1 - Initial Environment Setup
      workingDir: ${PROJECTS_ROOT}
    id: setup-environment

